###
# Munyire API Test File
#
# This file can be used with the "REST Client" extension in Visual Studio Code.
# It allows you to send HTTP requests directly from your editor.
#
# How to use:
# 1. Make sure your backend server is running (`npm start`).
# 2. First, run the "Register Admin" and "Register Manager" requests.
# 3. Then, run the "Login as Admin" and "Login as Manager" requests to get auth tokens.
# 4. The tokens will be automatically saved to variables (@adminToken, @managerToken).
# 5. Now you can run any of the other requests to test the API.
###

@baseUrl = http://localhost:3001/api

# @name adminToken
@adminToken = {{loginAdmin.response.body.token}}

# @name managerToken
@managerToken = {{loginManager.response.body.token}}


###
# 1. AUTHENTICATION (/auth)
###

# @name registerAdmin
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
    "DNev": "Admin User",
    "Email": "admin@test.com",
    "Telefonszam": "123456789",
    "Nem": "Male",
    "Munkakor": "Admin",
    "Admin": 1,
    "FelhasznaloNev": "adminuser",
    "Jelszo": "password123"
}

###

# @name registerManager
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
    "DNev": "Manager User",
    "Email": "manager@test.com",
    "Telefonszam": "987654321",
    "Nem": "Female",
    "Munkakor": "Manager",
    "Admin": 0,
    "FelhasznaloNev": "manageruser",
    "Jelszo": "password123"
}

###

# @name loginAdmin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "FelhasznaloNev": "adminuser",
    "Jelszo": "password123"
}

###

# @name loginManager
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "FelhasznaloNev": "manageruser",
    "Jelszo": "password123"
}


###
# 2. EMPLOYEES (/dolgozok) - Mostly Admin Only
###

# Get all employees (should work for Admin)
GET {{baseUrl}}/dolgozok
x-auth-token: {{adminToken}}

###

# Create a new employee (should FAIL for Manager - 403 Forbidden)
POST {{baseUrl}}/dolgozok
Content-Type: application/json
x-auth-token: {{managerToken}}

{
    "DNev": "New Employee by Manager",
    "Email": "new.manager@test.com",
    "FelhasznaloNev": "newemp_manager",
    "JelszoHash": "somehash"
}

###

# Create a new employee (should work for Admin)
POST {{baseUrl}}/dolgozok
Content-Type: application/json
x-auth-token: {{adminToken}}

{
    "DNev": "New Employee by Admin",
    "Email": "new.admin@test.com",
    "Telefonszam": "555-0101",
    "Nem": "Male",
    "Munkakor": "Worker",
    "Admin": 0,
    "FelhasznaloNev": "newemp_admin",
    "JelszoHash": "somehash"
}

###

# Delete an employee (should work for Admin)
DELETE {{baseUrl}}/dolgozok/3
x-auth-token: {{adminToken}}


###
# 3. CLOTHES (/ruhak) - View for Manager, Full Control for Admin
###

# Get all clothes (should work for Manager)
GET {{baseUrl}}/ruhak
x-auth-token: {{managerToken}}

###

# Create a new clothing item (should FAIL for Manager)
POST {{baseUrl}}/ruhak
Content-Type: application/json
x-auth-token: {{managerToken}}

{
    "Fajta": "Polo",
    "Szin": "Kek",
    "Meret": "L",
    "Mennyiseg": 50
}

###

# Create a new clothing item (should work for Admin)
# @name createRuha
POST {{baseUrl}}/ruhak
Content-Type: application/json
x-auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoxLCJ1c2VybmFtZSI6ImFkbWludXNlciIsImFkbWluIjoxLCJtdW5rYWtvciI6IkFkbWluIn0sImlhdCI6MTc2NTg3MzU1MSwiZXhwIjoxNzY1ODc3MTUxfQ.j7JtTpWzzLb3XVgZpTWBMhCV72cL0O-XvRud_Si22NQ

{
    "Fajta": "Nadrag",
    "Szin": "Fekete",
    "Meret": "M",
    "Mennyiseg": 100
}


###
# 4. CHECK-IN/OUT (/ruhakibe) - Create for Manager/Admin, Edit for Admin
###

# Get all records (should work for Manager)
GET {{baseUrl}}/ruhakibe
x-auth-token: {{managerToken}}

###

# Create a new record (should work for Manager)
POST {{baseUrl}}/ruhakibe
Content-Type: application/json
x-auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoxLCJ1c2VybmFtZSI6ImFkbWludXNlciIsImFkbWluIjoxLCJtdW5rYWtvciI6IkFkbWluIn0sImlhdCI6MTc2NTg3MzU1MSwiZXhwIjoxNzY1ODc3MTUxfQ.j7JtTpWzzLb3XVgZpTWBMhCV72cL0O-XvRud_Si22NQ

{
    "DID": 2,
    "KID": 1,
    "KiadasDatum": "2025-12-15",
    "VisszaDatum": null,
    "Mennyiseg": 2
}

###

# Update a record (should FAIL for Manager)
PUT {{baseUrl}}/ruhakibe/1
Content-Type: application/json
x-auth-token: {{managerToken}}

{
    "VisszaDatum": "2025-12-20"
}

###

# Update a record (should work for Admin)
PATCH {{baseUrl}}/ruhakibe/1
Content-Type: application/json
x-auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoxLCJ1c2VybmFtZSI6ImFkbWludXNlciIsImFkbWluIjoxLCJtdW5rYWtvciI6IkFkbWluIn0sImlhdCI6MTc2NTg3MzU1MSwiZXhwIjoxNzY1ODc3MTUxfQ.j7JtTpWzzLb3XVgZpTWBMhCV72cL0O-XvRud_Si22NQ

{
    "VisszaDatum": "2025-12-22"
}


###
# 5. ORDERS (/rendelesek) - Full control for Manager/Admin, except Delete
###

# Get all orders (should work for Manager)
GET {{baseUrl}}/rendelesek
x-auth-token: {{managerToken}}

###

# Create a new order (should work for Manager)
POST {{baseUrl}}/rendelesek
Content-Type: application/json
x-auth-token: {{managerToken}}

{
    "KID": 1,
    "RDatum": "2025-12-16",
    "Mennyiseg": 50
}

###

# Delete an order (should FAIL for Manager)
DELETE {{baseUrl}}/rendelesek/1
x-auth-token: {{managerToken}}

###

# Delete an order (should work for Admin)
DELETE {{baseUrl}}/rendelesek/1
x-auth-token: {{adminToken}}
